# macOS 快捷指令配置指南

## ✅ 优势

- ✅ **无需 ngrok**：macOS 快捷指令可以直接访问本地服务
- ✅ **快速测试**：修改代码后立即测试，无需等待
- ✅ **完全本地**：数据不经过公网，更安全
- ✅ **与 iOS 兼容**：macOS 快捷指令和 iOS 快捷指令使用相同的格式

---

## 🚀 快速开始

### 步骤 1：确保本地服务运行

```bash
cd /Users/lindadexiaoaojiao/Desktop/Builder/AIArchitect/TimeFlow
python3 app.py
```

服务地址：`http://127.0.0.1:8000`

### 步骤 2：创建 macOS 快捷指令

1. 打开 **快捷指令** 应用（macOS 自带）
2. 点击 **+** 创建新快捷指令
3. 命名为：`TimeFlow - 语音记录时间`

---

## 📱 快捷指令配置步骤

### 1. 录制音频

```
操作：录制音频
名称：录音
```

### 2. 发送到后端

```
操作：获取 URL 内容
URL: http://127.0.0.1:8000/api/mobile/process
方法: POST
请求体: 文件
文件: [录音]
```

**重要**：
- URL 使用 `http://127.0.0.1:8000`（本地地址）
- 不需要 `https`，本地服务使用 `http`
- 端口是 `8000`

### 3. 解析响应

```
操作：从输入中获取词典值
键: success
```

### 4. 检查是否成功

```
操作：如果
条件: [success] 等于 true
```

### 5. 获取事件数组

```
操作：从输入中获取词典值
键: events
```

### 6. 遍历事件

```
操作：为每个项目重复
输入: [events]
```

### 7. 添加日历事件

```
操作：添加日历事件
标题: [activity]
开始时间: [start_time]
结束时间: [end_time]
位置: [location]
备注: [description]
```

**注意**：
- `activity`、`start_time`、`end_time` 是必需字段
- `location` 和 `description` 是可选字段（可能为 null）

### 8. 显示结果

```
操作：显示通知
标题: 成功
内容: 已添加事件到日历
```

---

## 🧪 测试

### 测试步骤

1. 打开快捷指令应用
2. 运行 `TimeFlow - 语音记录时间`
3. 录制音频（例如："我刚刚吃完饭了，从12点到12点半"）
4. 查看结果

### 预期结果

- ✅ 转写文本显示在通知中
- ✅ 事件添加到日历
- ✅ 如果成功，显示"已添加事件到日历"

---

## 📋 完整快捷指令配置（文本格式）

```
1. 录制音频
   - 操作：录制音频
   - 名称：录音

2. 获取 URL 内容
   - URL: http://127.0.0.1:8000/api/mobile/process
   - 方法: POST
   - 请求体: 文件
   - 文件: [录音]

3. 从输入中获取词典值
   - 键: success

4. 如果
   - 条件: [success] 等于 true
   - 然后：
     a. 从输入中获取词典值
        - 键: events
     b. 为每个项目重复
        - 输入: [events]
        - 操作：
          - 添加日历事件
            - 标题: [activity]
            - 开始时间: [start_time]
            - 结束时间: [end_time]
            - 位置: [location]
            - 备注: [description]
     c. 显示通知
        - 标题: 成功
        - 内容: 已添加事件到日历
   - 否则：
     - 显示通知
       - 标题: 失败
       - 内容: [从输入中获取词典值 - 键: error]
```

---

## 🔍 调试技巧

### 1. 查看响应内容

在"获取 URL 内容"后添加：

```
操作：显示通知
标题: 响应
内容: [URL 内容]
```

这样可以查看完整的 API 响应，便于调试。

### 2. 检查字段

在"从输入中获取词典值"后，可以添加：

```
操作：显示通知
标题: 事件数量
内容: [events 数量]
```

### 3. 测试单个字段

可以单独测试某个字段：

```
操作：从输入中获取词典值
键: transcript

操作：显示通知
标题: 转写文本
内容: [transcript]
```

---

## ⚠️ 常见问题

### Q1: 无法连接到服务器

**检查**：
1. 本地服务是否运行：`curl http://127.0.0.1:8000/`
2. URL 是否正确：`http://127.0.0.1:8000/api/mobile/process`
3. 端口是否正确：`8000`

### Q2: 响应格式错误

**检查**：
1. API 是否返回 JSON 格式
2. 字段名是否正确：`success`、`events`、`activity`、`start_time`、`end_time`

### Q3: 日历事件未添加

**检查**：
1. 快捷指令是否有日历权限
2. 字段值是否正确（特别是时间格式）
3. 查看快捷指令运行日志

### Q4: 时间格式问题

**注意**：
- API 返回的时间格式：`2024-01-30T12:00:00`（ISO 8601）
- macOS 快捷指令的"添加日历事件"会自动解析这个格式

---

## 📱 iOS 快捷指令（后续使用）

当你在 macOS 上测试完成后，可以：

1. **导出快捷指令**：
   - 在 macOS 快捷指令中，右键点击快捷指令
   - 选择"共享" → "复制链接"
   - 或直接 AirDrop 到 iPhone

2. **在 iOS 上使用**：
   - 需要将 URL 改为云端地址（部署后）
   - 或使用 ngrok/Cloudflare Tunnel（如果需要在手机上测试本地服务）

---

## 🎯 工作流程

### 开发阶段（macOS 快捷指令）

1. ✅ 修改代码
2. ✅ 重启本地服务（如果需要）
3. ✅ 在 macOS 快捷指令中测试
4. ✅ 查看结果，继续优化

### 部署阶段（iOS 快捷指令）

1. ✅ 代码测试通过
2. ✅ 部署到云端
3. ✅ 更新 iOS 快捷指令 URL 为云端地址
4. ✅ 在手机上测试

---

## 📚 相关文档

- [手机 API 参考](./MOBILE_API_REFERENCE.md) - API 详细说明
- [快速启动指南](./QUICK_START.md) - 快速开始
- [本地设置指南](./LOCAL_SETUP_GUIDE.md) - 详细设置

---

## ✅ 检查清单

- [ ] 本地服务已启动（`http://127.0.0.1:8000`）
- [ ] 快捷指令已创建
- [ ] URL 配置为 `http://127.0.0.1:8000/api/mobile/process`
- [ ] 测试录音功能
- [ ] 测试日历写入功能
- [ ] 查看结果并优化

---

## 🎉 完成！

现在你可以：
1. ✅ 在 macOS 快捷指令中快速测试
2. ✅ 修改代码后立即看到效果
3. ✅ 无需配置 ngrok，完全本地测试
4. ✅ 测试完成后，可以部署到云端并在 iOS 上使用
